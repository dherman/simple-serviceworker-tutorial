<!DOCTYPE html>
<html>
  <head>
    <title>Demo of Cross-Origin Script Injection</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <h1>Demo of Cross-Origin Script Injection</h1>

    <p>If I've got this right, I believe this page demonstrates that ServiceWorkers can see the request URL of (non-CORS) cross-origin scripts, even ones transitively injected by other cross-origin scripts.</p>

    <p class="instructions">To see the demo in action, do a non-forced reload of this page (i.e., don't use shift-reload).</p>

    <!-- install some functions loaded locally -->
    <script src="script.js"></script>

    <!-- register the service worker -->
    <script>
      navigator.serviceWorker.register('sw.js', { scope: './' });
      setupChannel(data => {
        var p = document.createElement('p');
        p.innerHTML = "<b>Intercepted:</b> " + data;
        document.body.appendChild(p);
      });
    </script>

    <!-- some stuff from jake's tutorial, not relevant I think -->
    <script src="logging.js"></script>

    <!-- now load the remote source code -->
    <script>
      loader.import('foreign', 'https://xoscript.surge.sh/foreign-module.js')
            .then((foreign) => {
              document.getElementById('inspect').disabled = false;
            });
    </script>

    <button id=inspect onclick="document.getElementById('output').innerText = loader.inspect();" disabled>Inspect Registry</button>

    <pre id=output></pre>
  </body>
</html>
